<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Serum Preset Preview</title>

<style>
body {
  margin: 0;
  padding: 40px;
  background: radial-gradient(circle at center, #0f140f, #050705);
  font-family: monospace;
  color: #9cff9c;
  display: flex;
  justify-content: center;
}

/* MAIN BLOCK */
.preview {
  width: 960px;
  position: relative;
  opacity: 0;
  transition: opacity 0.8s ease;
}

.preview.ready {
  opacity: 1;
}

/* LOADER */
.loader {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.95);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 15px;
  letter-spacing: 3px;
  color: #2aff2a;
  z-index: 50;
  animation: pulse 1.2s infinite;
}

@keyframes pulse {
  0% { opacity: .3; }
  50% { opacity: 1; }
  100% { opacity: .3; }
}

/* VIDEO */
video {
  width: 100%;
  display: block;
  border-radius: 8px;
  background: #000;
}

/* PRESET LABEL */
.label {
  position: absolute;
  bottom: 12px;
  left: 16px;
  background: rgba(0,0,0,0.65);
  padding: 6px 10px;
  font-size: 13px;
  letter-spacing: 1px;
}

/* NAV BUTTONS */
.nav {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(0,0,0,0.75);
  border: 1px solid #2aff2a;
  color: #9cff9c;
  padding: 12px 16px;
  font-size: 18px;
  cursor: pointer;
  user-select: none;
}

.nav:hover {
  background: rgba(0,0,0,0.95);
}

.prev { left: 10px; }
.next { right: 10px; }

/* KEYBOARD */
.keyboard {
  position: relative;
  height: 130px;
  margin-top: 18px;
  user-select: none;
}

.key.white {
  float: left;
  width: calc(100% / 8);
  height: 130px;
  background: linear-gradient(#1a1a1a, #0b0b0b);
  border: 1px solid #2aff2a;
  box-sizing: border-box;
  cursor: pointer;
  display: flex;
  justify-content: center;
  align-items: flex-end;
  padding-bottom: 8px;
  font-size: 12px;
}

.key.black {
  position: absolute;
  top: 0;
  width: 34px;
  height: 80px;
  background: linear-gradient(#000, #111);
  border: 1px solid #2aff2a;
  z-index: 5;
  cursor: pointer;
}

/* BLACK KEYS */
.b1 { left: 10%; }
.b2 { left: 22.5%; }
.b3 { left: 47.5%; }
.b4 { left: 60%; }
.b5 { left: 72.5%; }

.key:active {
  background: #2aff2a !important;
  color: #000;
  box-shadow: 0 0 14px #2aff2a;
}
</style>
</head>

<body>

<div class="preview" id="preview">

  <div class="loader" id="loader">
    LOADING PRESETS…
  </div>

  <video id="video" loop muted playsinline></video>

  <div class="nav prev" onclick="prevPreset()">◄</div>
  <div class="nav next" onclick="nextPreset()">►</div>

  <div class="label" id="presetLabel">PRESET</div>

  <div class="keyboard">
    <div class="key white" onclick="playNote(0)">C</div>
    <div class="key white" onclick="playNote(2)">D</div>
    <div class="key white" onclick="playNote(4)">E</div>
    <div class="key white" onclick="playNote(5)">F</div>
    <div class="key white" onclick="playNote(7)">G</div>
    <div class="key white" onclick="playNote(9)">A</div>
    <div class="key white" onclick="playNote(11)">B</div>
    <div class="key white" onclick="playNote(12)">C</div>

    <div class="key black b1" onclick="playNote(1)"></div>
    <div class="key black b2" onclick="playNote(3)"></div>
    <div class="key black b3" onclick="playNote(6)"></div>
    <div class="key black b4" onclick="playNote(8)"></div>
    <div class="key black b5" onclick="playNote(10)"></div>
  </div>

</div>

<script>
const presets = [
  { name: "STRINGS 06", video: "preset01.mp4", audio: "preset01.wav" },
  { name: "DRONE 02",   video: "preset02.mp4", audio: "preset02.wav" },
  { name: "BASS 04",    video: "preset03.mp4", audio: "preset03.wav" }
];

let index = 0;
const video = document.getElementById("video");
const label = document.getElementById("presetLabel");

let audioCtx;
let source;
const bufferCache = {};

function initAudio() {
  if (!audioCtx) {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }
}

function loadPreset(i) {
  index = (i + presets.length) % presets.length;
  video.pause();
  video.src = presets[index].video;
  label.textContent = `PRESET ${index + 1} — ${presets[index].name}`;
}

function nextPreset() { loadPreset(index + 1); }
function prevPreset() { loadPreset(index - 1); }

async function playNote(semitones) {
  initAudio();

  if (source) source.stop();

  if (!bufferCache[index]) {
    const res = await fetch(presets[index].audio);
    const arr = await res.arrayBuffer();
    bufferCache[index] = await audioCtx.decodeAudioData(arr);
  }

  source = audioCtx.createBufferSource();
  source.buffer = bufferCache[index];
  source.playbackRate.value = Math.pow(2, semitones / 12);
  source.connect(audioCtx.destination);
  source.start();

  video.currentTime = 0;
  video.play().catch(() => {});
  setTimeout(() => video.pause(), 1600);
}

/* INIT */
loadPreset(0);

/* LOADER TIMER */
const preview = document.getElementById("preview");
const loader = document.getElementById("loader");

setTimeout(() => {
  loader.remove();
  preview.classList.add("ready");
}, 2500);
</script>

</body>
</html>
