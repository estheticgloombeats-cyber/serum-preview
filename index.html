<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PAL Serum Preset Preview</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  background: #011560;
  font-family: monospace;
  color: #ffffff;
}

/* MAIN BLOCK */
.preview {
  width: 100%;
  max-width: 960px;
  margin: 16px auto;
  position: relative;
  opacity: 0;
  transition: opacity 0.8s ease;
}

.preview.ready {
  opacity: 1;
}

/* LOADER */
.loader {
  position: absolute;
  inset: 0;
  background: rgba(1,21,96,0.95);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 13px;
  letter-spacing: 3px;
  color: #ffffff;
  z-index: 50;
  animation: pulse 1.2s infinite;
}

@keyframes pulse {
  0% { opacity: .3; }
  50% { opacity: 1; }
  100% { opacity: .3; }
}

/* VIDEO */
video {
  width: 100%;
  display: block;
  border-radius: 6px;
  background: transparent;
  box-shadow: 0 0 12px rgba(255,255,255,0.2);
}

/* PRESET LABEL */
.label {
  position: absolute;
  bottom: 10px;
  left: 12px;
  background: rgba(0,0,0,0.4);
  padding: 5px 10px;
  font-size: 12px;
  letter-spacing: 2px;
  color: #ffffff;
  border: 1px solid #ffffff;
}

/* NAV BUTTONS */
.nav {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(0,0,0,0.4);
  border: 1px solid #ffffff;
  color: #ffffff;
  padding: 10px 14px;
  font-size: 16px;
  cursor: pointer;
  user-select: none;
}

.prev { left: 8px; }
.next { right: 8px; }

/* KEYBOARD */
.keyboard {
  position: relative;
  height: 120px;
  margin-top: 14px;
  user-select: none;
}

/* WHITE KEYS */
.key.white {
  float: left;
  width: calc(100% / 8);
  height: 120px;
  background: linear-gradient(#ffffff, #dbe7ff);
  border: 1px solid #ffffff;
  box-sizing: border-box;
  cursor: pointer;
  display: flex;
  justify-content: center;
  align-items: flex-end;
  padding-bottom: 6px;
  font-size: 11px;
  color: #011560;
}

/* BLACK KEYS */
.key.black {
  position: absolute;
  top: 0;
  width: 28px;
  height: 70px;
  background: linear-gradient(#001033, #00081a);
  border: 1px solid #ffffff;
  z-index: 5;
  cursor: pointer;
}

/* BLACK KEYS POSITION */
.b1 { left: 10%; }
.b2 { left: 22.5%; }
.b3 { left: 47.5%; }
.b4 { left: 60%; }
.b5 { left: 72.5%; }

.key:active {
  background: #ffffff !important;
  color: #011560;
  box-shadow: 0 0 10px #ffffff;
}

/* MOBILE */
@media (max-width: 600px) {
  .keyboard {
    height: 90px;
  }

  .key.white {
    height: 90px;
    font-size: 10px;
  }

  .key.black {
    width: 22px;
    height: 55px;
  }

  .nav {
    padding: 8px 10px;
    font-size: 14px;
  }

  .label {
    font-size: 10px;
  }
}
</style>
</head>

<body>

<div class="preview" id="preview">

  <div class="loader" id="loader">
    TAP TO ENABLE AUDIO
  </div>

  <video id="video" loop muted playsinline></video>

  <div class="nav prev" onclick="prevPreset()">◄</div>
  <div class="nav next" onclick="nextPreset()">►</div>

  <div class="label" id="presetLabel">PRESET</div>

  <div class="keyboard">
    <div class="key white" onclick="playNote(0)">C</div>
    <div class="key white" onclick="playNote(2)">D</div>
    <div class="key white" onclick="playNote(4)">E</div>
    <div class="key white" onclick="playNote(5)">F</div>
    <div class="key white" onclick="playNote(7)">G</div>
    <div class="key white" onclick="playNote(9)">A</div>
    <div class="key white" onclick="playNote(11)">B</div>
    <div class="key white" onclick="playNote(12)">C</div>

    <div class="key black b1" onclick="playNote(1)"></div>
    <div class="key black b2" onclick="playNote(3)"></div>
    <div class="key black b3" onclick="playNote(6)"></div>
    <div class="key black b4" onclick="playNote(8)"></div>
    <div class="key black b5" onclick="playNote(10)"></div>
  </div>

</div>

<script>
const presets = [
  { name: "PAL 01", video: "preset01.mp4", audio: "preset01.mp3" },
  { name: "PAL 02", video: "preset02.mp4", audio: "preset02.mp3" },
  { name: "PAL 03", video: "preset03.mp4", audio: "preset03.mp3" },
  { name: "PAL 04", video: "preset04.mp4", audio: "preset04.mp3" },
  { name: "PAL 05", video: "preset05.mp4", audio: "preset05.mp3" },
  { name: "PAL 06", video: "preset06.mp4", audio: "preset06.mp3" },
  { name: "PAL 07", video: "preset07.mp4", audio: "preset07.mp3" },
  { name: "PAL 08", video: "preset08.mp4", audio: "preset08.mp3" },
  { name: "PAL 09", video: "preset09.mp4", audio: "preset09.mp3" },
  { name: "PAL 10", video: "preset10.mp4", audio: "preset10.mp3" },
  { name: "PAL 11", video: "preset11.mp4", audio: "preset11.mp3" },
  { name: "PAL 12", video: "preset12.mp4", audio: "preset12.mp3" },
  { name: "PAL 13", video: "preset13.mp4", audio: "preset13.mp3" },
  { name: "PAL 14", video: "preset14.mp4", audio: "preset14.mp3" },
  { name: "PAL 15", video: "preset15.mp4", audio: "preset15.mp3" },
  { name: "PAL 16", video: "preset16.mp4", audio: "preset16.mp3" },
  { name: "PAL 17", video: "preset17.mp4", audio: "preset17.mp3" },
  { name: "PAL 18", video: "preset18.mp4", audio: "preset18.mp3" }
];

let index = 0;
const video = document.getElementById("video");
const label = document.getElementById("presetLabel");

let audioCtx;
let source;
const bufferCache = {};

function initAudio() {
  if (!audioCtx) {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }
  audioCtx.resume();
}

document.body.addEventListener("touchstart", initAudio, { once: true });
document.body.addEventListener("click", initAudio, { once: true });

function loadPreset(i) {
  index = (i + presets.length) % presets.length;
  video.pause();
  video.src = presets[index].video;
  label.textContent = `PRESET ${index + 1} — ${presets[index].name}`;
}

function nextPreset() { loadPreset(index + 1); }
function prevPreset() { loadPreset(index - 1); }

async function playNote(semitones) {
  initAudio();

  if (source) source.stop();

  if (!bufferCache[index]) {
    const res = await fetch(presets[index].audio);
    const arr = await res.arrayBuffer();
    bufferCache[index] = await audioCtx.decodeAudioData(arr);
  }

  source = audioCtx.createBufferSource();
  source.buffer = bufferCache[index];
  source.playbackRate.value = Math.pow(2, semitones / 12);
  source.connect(audioCtx.destination);
  source.start();

  video.currentTime = 0;
  video.play().catch(() => {});
  setTimeout(() => video.pause(), 1600);
}

/* INIT */
loadPreset(0);

/* LOADER TIMER */
const preview = document.getElementById("preview");
const loader = document.getElementById("loader");

setTimeout(() => {
  loader.remove();
  preview.classList.add("ready");
}, 1500);
</script>

</body>
</html>
